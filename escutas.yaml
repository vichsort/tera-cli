api:
  name: "Escutas API"
  version: "1.0.0"
  description: "API para gerenciamento de reviews de álbuns musicais."
  base_url: "http://localhost:5000"
  auth:
    type: bearer

endpoints:
  # ---------------------------------------------------------
  # BUSCA DE ÁLBUMS (GET Simples com Query Param)
  # ---------------------------------------------------------
  - path: /api/albums/search
    method: GET
    tag: Albums
    summary: "Buscar Álbuns"
    description: "Busca por álbuns utilizando a API do Spotify."
    auth_required: true

    params:
      query:
        - name: q
          example: "Pink Floyd" # Script infere: type string
          required: true
          min_length: 2
          description: "Termo de pesquisa (Nome do álbum ou artista)."

    responses:
      success:
        example:
          status: "success"
          data:
            - id: "4LH4d3cOWNNsVw41Gqt2kv"
              name: "The Dark Side of the Moon"
              artist: "Pink Floyd"
              year: "1973"

      errors:
        - status: 400
          message: "Erro de Validação"
          example: { "message": "Termo muito curto" }
        - status: 401
          message: "Não Autorizado"

  # ---------------------------------------------------------
  # LOGIN (Redirect 302 - Caso Especial)
  # ---------------------------------------------------------
  - path: /api/login
    method: GET
    tag: Auth
    summary: "Iniciar Login"
    description: "Redireciona para o Spotify."

    responses:
      success:
        status: 302
        description: "Redirecionamento para o Spotify"
        # O script Python terá que ser esperto aqui:
        # Se ver status 302, tratar o exemplo como Header Location ou body simples
        example: 
          url: "https://accounts.spotify.com/authorize?..."

  # ---------------------------------------------------------
  # CRIAR REVIEW (O Teste de Fogo: BODY COMPLEXO)
  # ---------------------------------------------------------
  - path: /api/reviews
    method: POST
    tag: Reviews
    summary: "Criar Nova Review"
    auth_required: true
    
    body:
      # AQUI ESTÁ A MÁGICA:
      # Como passamos um objeto completo no 'example', 
      # o Script Python vai gerar a estrutura aninhada (Nested Objects) automaticamente.
      - name: album
        required: true
        example: 
          id: "4LH4d3cOWNNsVw41Gqt2kv"
          name: "Dark Side of the Moon"
          artist: "Pink Floyd"
          cover: "https://i.scdn.co/..."
      
      - name: review_text
        example: "Obra prima."
        required: true

      - name: tracks
        required: true
        example: 
          - id: "t1"
            name: "Speak to Me"
            userScore: 10

    responses:
      success:
        status: 201
        description: "Review Criada"
        example:
          status: "success"
          id: "uuid-da-review"
          tier: "S"

  # ---------------------------------------------------------
  # PERFIL PÚBLICO (Path Parameters)
  # ---------------------------------------------------------
  - path: /api/users/{user_uuid}
    method: GET
    tag: Users
    summary: "Perfil Público"
    auth_required: true

    params:
      path:
        - name: user_uuid
          example: "a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11" # Script infere UUID/String
          required: true

    responses:
      success:
        example:
          id: "a0eebc..."
          display_name: "Maria Music"
          avatar_url: "https://..."
      
      errors:
        - status: 404
          message: "Usuário não encontrado"